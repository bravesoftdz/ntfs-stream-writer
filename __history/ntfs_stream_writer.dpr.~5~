program ntfs_stream_writer;

{$APPTYPE CONSOLE}

uses
  SysUtils,
  windows;

function CopyFileI(source, dest:pchar):boolean;
var h,h2:integer;
mas:array[1..2048] of byte;
i:cardinal;
done:cardinal;
begin
result:=false;
h:=CreateFile(source,GENERIC_READ,FILE_SHARE_READ,nil,OPEN_EXISTING,0,0);
if h=-1 then exit;
h2:=CreateFile(dest,GENERIC_WRITE,FILE_SHARE_WRITE,nil,OPEN_ALWAYS,0,0);
while ReadFile(h,mas,sizeof(mas),done,nil) and(done<>0) do
WriteFile(h2,mas,done,i,nil);
CloseHandle(h);
CloseHandle(h2);
result:=true;
end;

var
s:string;
StreamName:string;
begin
ExitCode:=0;
// Проверяем  что нам передали не менее двух параметров - иначе нафиг
if ParamCount<2 then
BEGIN
Writeln('First param - sourse ntfs stream in format:');
Writeln('"Full File Path + Name + Extension + : + StreamName"');
Writeln('Second param - destination file name, filename where to save stream');
ExitCode:=1;
Exit;
END;

if CopyFileI(pansichar(paramstr(1)),pansichar(paramstr(2))) then
  Writeln('New file "'+ParamStr(2)+'" created')
else
  begin
    ExitCode:=2;
    Writeln('Unable to extract stream to file "' + ParamStr(2)+'"');
  end;

end.
